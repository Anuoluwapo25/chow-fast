import{a7 as S,cd as u,c4 as M,dT as $,c2 as V,bZ as F,bY as _,cL as K,dU as W,dV as U,dW as j,cB as D,dX as Y,O as q,bQ as w,bE as z,a6 as T,bS as A,ce as Z,cb as Q,dY as X,dZ as J,_ as ee,d_ as te,a5 as se,ab as L,B as H,ax as k,aF as ne,d$ as re,bV as ie,bW as oe,e0 as ae,e1 as ce,e2 as ue,bg as le,cN as de,cg as P,cc as fe,bG as he,bI as xe,bH as be,bK as me,be as ge,cf as R,e3 as ye,bt as pe,c7 as we,l as Pe,m as ze,e4 as Te}from"./index-DUZ-i8oO.js";class Ie extends S{constructor(t){super(`Call bundle failed with status: ${t.statusCode}`,{name:"BundleFailedError"}),Object.defineProperty(this,"result",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.result=t}}const ve="0x5792579257925792579257925792579257925792579257925792579257925792",Ee=u(0,{size:32});async function Fe(e,t){async function n(c){if(c.endsWith(ve.slice(2))){const h=F(_(c,-64,-32)),f=_(c,0,-64).slice(2).match(/.{1,64}/g),y=await Promise.all(f.map(b=>Ee.slice(2)!==b?e.request({method:"eth_getTransactionReceipt",params:[`0x${b}`]},{dedupe:!0}):void 0)),m=y.some(b=>b===null)?100:y.every(b=>b?.status==="0x1")?200:y.every(b=>b?.status==="0x0")?500:600;return{atomic:!1,chainId:M(h),receipts:y.filter(Boolean),status:m,version:"2.0.0"}}return e.request({method:"wallet_getCallsStatus",params:[c]})}const{atomic:s=!1,chainId:r,receipts:i,version:a="2.0.0",...o}=await n(t.id),[d,l]=(()=>{const c=o.status;return c>=100&&c<200?["pending",c]:c>=200&&c<300?["success",c]:c>=300&&c<700?["failure",c]:c==="CONFIRMED"?["success",200]:c==="PENDING"?["pending",100]:[void 0,c]})();return{...o,atomic:s,chainId:r?M(r):void 0,receipts:i?.map(c=>({...c,blockNumber:V(c.blockNumber),gasUsed:V(c.gasUsed),status:$[c.status]}))??[],statusCode:l,status:d,version:a}}async function Oe(e,t){const{id:n,pollingInterval:s=e.pollingInterval,status:r=({statusCode:m})=>m===200||m>=300,retryCount:i=4,retryDelay:a=({count:m})=>~~(1<<m)*200,timeout:o=6e4,throwOnFailure:d=!1}=t,l=K(["waitForCallsStatus",e.uid,n]),{promise:c,resolve:x,reject:h}=W();let f;const y=U(l,{resolve:x,reject:h},m=>{const b=j(async()=>{const I=p=>{clearTimeout(f),b(),p(),y()};try{const p=await D(async()=>{const g=await Y(e,Fe,"getCallsStatus")({id:n});if(d&&g.status==="failure")throw new Ie(g);return g},{retryCount:i,delay:a});if(!r(p))return;I(()=>m.resolve(p))}catch(p){I(()=>m.reject(p))}},{interval:s,emitOnBegin:!0});return b});return f=o?setTimeout(()=>{y(),clearTimeout(f),h(new Ce({id:n}))},o):void 0,await c}class Ce extends S{constructor({id:t}){super(`Timed out while waiting for call bundle with id "${t}" to be confirmed.`,{name:"WaitForCallsStatusTimeoutError"})}}function $e(e,t){if(e.length!==t.length)throw new q({expectedLength:e.length,givenLength:t.length});const n=[];for(let s=0;s<e.length;s++){const r=e[s],i=t[s];n.push(O(r,i))}return w(n)}function O(e,t,n=!1){if(e==="address"){const a=t;if(!z(a))throw new T({address:a});return A(a.toLowerCase(),{size:n?32:null})}if(e==="string")return Z(t);if(e==="bytes")return t;if(e==="bool")return A(Q(t),{size:n?32:1});const s=e.match(X);if(s){const[a,o,d="256"]=s,l=Number.parseInt(d,10)/8;return u(t,{size:n?32:l,signed:o==="int"})}const r=e.match(J);if(r){const[a,o]=r;if(Number.parseInt(o,10)!==(t.length-2)/2)throw new ee({expectedSize:Number.parseInt(o,10),givenSize:(t.length-2)/2});return A(t,{dir:"right",size:n?32:null})}const i=e.match(te);if(i&&Array.isArray(t)){const[a,o]=i,d=[];for(let l=0;l<t.length;l++)d.push(O(o,t[l],!0));return d.length===0?"0x":w(d)}throw new se(e)}function Ge(e){const{authorizationList:t}=e;if(t)for(const n of t){const{chainId:s}=n,r=n.address;if(!z(r))throw new T({address:r});if(s<0)throw new L({chainId:s})}N(e)}function Se(e){const{blobVersionedHashes:t}=e;if(t){if(t.length===0)throw new re;for(const n of t){const s=ie(n),r=M(oe(n,0,1));if(s!==32)throw new ae({hash:n,size:s});if(r!==ce)throw new ue({hash:n,version:r})}}N(e)}function N(e){const{chainId:t,maxPriorityFeePerGas:n,maxFeePerGas:s,to:r}=e;if(t<=0)throw new L({chainId:t});if(r&&!z(r))throw new T({address:r});if(s&&s>H)throw new k({maxFeePerGas:s});if(n&&s&&n>s)throw new ne({maxFeePerGas:s,maxPriorityFeePerGas:n})}function Le(e){const{chainId:t,maxPriorityFeePerGas:n,gasPrice:s,maxFeePerGas:r,to:i}=e;if(t<=0)throw new L({chainId:t});if(i&&!z(i))throw new T({address:i});if(n||r)throw new S("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid EIP-2930 Transaction attribute.");if(s&&s>H)throw new k({maxFeePerGas:s})}function Be(e){const{chainId:t,maxPriorityFeePerGas:n,gasPrice:s,maxFeePerGas:r,to:i}=e;if(i&&!z(i))throw new T({address:i});if(typeof t<"u"&&t<=0)throw new L({chainId:t});if(n||r)throw new S("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid Legacy Transaction attribute.");if(s&&s>H)throw new k({maxFeePerGas:s})}function B(e){if(!e||e.length===0)return[];const t=[];for(let n=0;n<e.length;n++){const{address:s,storageKeys:r}=e[n];for(let i=0;i<r.length;i++)if(r[i].length-2!==64)throw new le({storageKey:r[i]});if(!z(s,{strict:!1}))throw new T({address:s});t.push([s,r])}return t}function Ke(e,t){const n=de(e);return n==="eip1559"?He(e,t):n==="eip2930"?ke(e,t):n==="eip4844"?Me(e,t):n==="eip7702"?Ae(e,t):Ne(e,t)}function Ae(e,t){const{authorizationList:n,chainId:s,gas:r,nonce:i,to:a,value:o,maxFeePerGas:d,maxPriorityFeePerGas:l,accessList:c,data:x}=e;Ge(e);const h=B(c),f=Ve(n);return w(["0x04",P([u(s),i?u(i):"0x",l?u(l):"0x",d?u(d):"0x",r?u(r):"0x",a??"0x",o?u(o):"0x",x??"0x",h,f,...C(e,t)])])}function Me(e,t){const{chainId:n,gas:s,nonce:r,to:i,value:a,maxFeePerBlobGas:o,maxFeePerGas:d,maxPriorityFeePerGas:l,accessList:c,data:x}=e;Se(e);let h=e.blobVersionedHashes,f=e.sidecars;if(e.blobs&&(typeof h>"u"||typeof f>"u")){const g=typeof e.blobs[0]=="string"?e.blobs:e.blobs.map(E=>fe(E)),G=e.kzg,v=he({blobs:g,kzg:G});if(typeof h>"u"&&(h=xe({commitments:v})),typeof f>"u"){const E=be({blobs:g,commitments:v,kzg:G});f=me({blobs:g,commitments:v,proofs:E})}}const y=B(c),m=[u(n),r?u(r):"0x",l?u(l):"0x",d?u(d):"0x",s?u(s):"0x",i??"0x",a?u(a):"0x",x??"0x",y,o?u(o):"0x",h??[],...C(e,t)],b=[],I=[],p=[];if(f)for(let g=0;g<f.length;g++){const{blob:G,commitment:v,proof:E}=f[g];b.push(G),I.push(v),p.push(E)}return w(["0x03",f?P([m,b,I,p]):P(m)])}function He(e,t){const{chainId:n,gas:s,nonce:r,to:i,value:a,maxFeePerGas:o,maxPriorityFeePerGas:d,accessList:l,data:c}=e;N(e);const x=B(l),h=[u(n),r?u(r):"0x",d?u(d):"0x",o?u(o):"0x",s?u(s):"0x",i??"0x",a?u(a):"0x",c??"0x",x,...C(e,t)];return w(["0x02",P(h)])}function ke(e,t){const{chainId:n,gas:s,data:r,nonce:i,to:a,value:o,accessList:d,gasPrice:l}=e;Le(e);const c=B(d),x=[u(n),i?u(i):"0x",l?u(l):"0x",s?u(s):"0x",a??"0x",o?u(o):"0x",r??"0x",c,...C(e,t)];return w(["0x01",P(x)])}function Ne(e,t){const{chainId:n=0,gas:s,data:r,nonce:i,to:a,value:o,gasPrice:d}=e;Be(e);let l=[i?u(i):"0x",d?u(d):"0x",s?u(s):"0x",a??"0x",o?u(o):"0x",r??"0x"];if(t){const c=(()=>{if(t.v>=35n)return(t.v-35n)/2n>0?t.v:27n+(t.v===35n?0n:1n);if(n>0)return BigInt(n*2)+BigInt(35n+t.v-27n);const f=27n+(t.v===27n?0n:1n);if(t.v!==f)throw new ge({v:t.v});return f})(),x=F(t.r),h=F(t.s);l=[...l,u(c),x==="0x00"?"0x":x,h==="0x00"?"0x":h]}else n>0&&(l=[...l,u(n),"0x","0x"]);return P(l)}function C(e,t){const n=t??e,{v:s,yParity:r}=n;if(typeof n.r>"u")return[];if(typeof n.s>"u")return[];if(typeof s>"u"&&typeof r>"u")return[];const i=F(n.r),a=F(n.s);return[typeof r=="number"?r?u(1):"0x":s===0n?"0x":s===1n?u(1):s===27n?"0x":u(1),i==="0x00"?"0x":i,a==="0x00"?"0x":a]}function Ve(e){if(!e||e.length===0)return[];const t=[];for(const n of e){const{chainId:s,nonce:r,...i}=n,a=n.address;t.push([s?R(s):"0x",a,r?R(r):"0x",...C({},i)])}return t}function We(e){const{source:t}=e,n=new Map,s=new ye(8192),r=new Map,i=({address:a,chainId:o})=>`${a}.${o}`;return{async consume({address:a,chainId:o,client:d}){const l=i({address:a,chainId:o}),c=this.get({address:a,chainId:o,client:d});this.increment({address:a,chainId:o});const x=await c;return await t.set({address:a,chainId:o},x),s.set(l,x),x},async increment({address:a,chainId:o}){const d=i({address:a,chainId:o}),l=n.get(d)??0;n.set(d,l+1)},async get({address:a,chainId:o,client:d}){const l=i({address:a,chainId:o});let c=r.get(l);return c||(c=(async()=>{try{const h=await t.get({address:a,chainId:o,client:d}),f=s.get(l)??0;return f>0&&h<=f?f+1:(s.delete(l),h)}finally{this.reset({address:a,chainId:o})}})(),r.set(l,c)),(n.get(l)??0)+await c},reset({address:a,chainId:o}){const d=i({address:a,chainId:o});n.delete(d),r.delete(d)}}}const _e="0x6492649264926492649264926492649264926492649264926492649264926492";function Ue(e){const{address:t,data:n,signature:s,to:r="hex"}=e,i=w([pe([{type:"address"},{type:"bytes"},{type:"bytes"}],[t,n,s]),_e]);return r==="hex"?i:we(i)}function je(e){const{key:t="public",name:n="Public Client"}=e;return Pe({...e,key:t,name:n,type:"publicClient"}).extend(ze)}function De(e){const{r:t,s:n}=Te.Signature.fromCompact(e.slice(2,130)),s=+`0x${e.slice(130)}`,[r,i]=(()=>{if(s===0||s===1)return[void 0,s];if(s===27)return[BigInt(s),0];if(s===28)return[BigInt(s),1];throw new Error("Invalid yParityOrV value")})();return typeof r<"u"?{r:u(t,{size:32}),s:u(n,{size:32}),v:r,yParity:i}:{r:u(t,{size:32}),s:u(n,{size:32}),yParity:i}}export{Ie as B,Ce as W,We as a,N as b,je as c,Le as d,$e as e,Be as f,B as g,Ke as h,De as p,Ue as s,Oe as w};
